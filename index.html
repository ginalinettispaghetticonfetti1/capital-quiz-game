<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Capital Quiz Pro - Full Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #121212;
  color: #ffffff;
  padding: 20px;
  text-align: center;
}
select, input, button {
  width: 100%;
  max-width: 360px;
  padding: 12px;
  margin: 8px 0;
  font-size: 16px;
  border-radius: 6px;
  border: none;
}
select, input { background: #1e1e1e; color: white; }
button { background: #2979ff; color: white; }
button:hover { background: #1c54b2; }
#question { font-size: 22px; margin: 20px 0; }
.correct { color: #4caf50; }
.accepted { color: #ffeb3b; }
.wrong { color: #f44336; }
#score { margin-top: 10px; font-size: 18px; }
</style>
</head>

<body>

<h1>üåç Capital Quiz Pro - Full Edition</h1>

<label>Category:</label>
<select id="category">
  <option value="world">World</option>
  <option value="africa">African countries</option>
  <option value="asia">Asian countries</option>
  <option value="europe">European countries</option>
  <option value="northamerica">North American countries</option>
  <option value="southamerica">South American countries</option>
  <option value="oceania">Oceania</option>
  <option value="middleeast">Middle East</option>
  <option value="india">India</option>
  <option value="canada">Canada</option>
</select>

<label>Difficulty:</label>
<select id="difficulty">
  <option value="easy">Easy</option>
  <option value="medium">Medium</option>
  <option value="hard">Hard</option>
</select>

<label>
  <input type="checkbox" id="mcMode"> Multiple Choice Mode
</label>

<button onclick="startQuiz()">Start Quiz</button>

<div id="question"></div>
<div id="answerArea"></div>

<button onclick="submitAnswer()">Submit</button>
<button onclick="nextQuestion()">Next</button>
<button onclick="resetScore()">Reset Score</button>
<button onclick="revealAnswer()">Reveal Answer</button>

<div id="result"></div>
<div id="score">Score: 0 / 0</div>

<script>
// -------- SOUNDS --------
const soundCorrect = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const soundWrong = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

// -------- SCORE --------
let score = 0;
let total = 0;
const sessionLimit = 30; // max questions per session
let currentAnswer = [];

// -------- DATA --------
const worldCapitals = {
"Afghanistan":["Kabul"],"Albania":["Tirana"],"Algeria":["Algiers"],"Andorra":["Andorra la Vella"],
// ... (add all other countries as needed)
"Zimbabwe":["Harare"]
};

const continents = {
  africa: ["Algeria","Angola","Benin","Botswana","Burundi","Cameroon","Cape Verde","Central African Republic","Chad","Comoros","Congo","Democratic Republic of Congo","Djibouti","Egypt","Equatorial Guinea","Eritrea","Eswatini","Ethiopia","Gabon","Gambia","Ghana","Guinea","Guinea-Bissau","Ivory Coast","Kenya","Lesotho","Liberia","Libya","Madagascar","Malawi","Mali","Mauritania","Mauritius","Morocco","Mozambique","Namibia","Niger","Nigeria","Rwanda","Sao Tome and Principe","Senegal","Seychelles","Sierra Leone","Somalia","South Africa","South Sudan","Sudan","Tanzania","Togo","Tunisia","Uganda","Zambia","Zimbabwe"],
  asia: ["Afghanistan","Armenia","Azerbaijan","Bahrain","Bangladesh","Bhutan","Brunei","Cambodia","China","Cyprus","Georgia","India","Indonesia","Iran","Iraq","Israel","Japan","Jordan","Kazakhstan","Kuwait","Kyrgyzstan","Laos","Lebanon","Malaysia","Maldives","Mongolia","Myanmar","Nepal","North Korea","Oman","Pakistan","Palestine","Philippines","Qatar","Saudi Arabia","Singapore","South Korea","Sri Lanka","Syria","Taiwan","Tajikistan","Thailand","Timor-Leste","Turkmenistan","United Arab Emirates","Uzbekistan","Vietnam","Yemen"],
  europe: ["Albania","Andorra","Austria","Belarus","Belgium","Bosnia and Herzegovina","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Iceland","Ireland","Italy","Kosovo","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Moldova","Monaco","Montenegro","Netherlands","North Macedonia","Norway","Poland","Portugal","Romania","Russia","San Marino","Serbia","Slovakia","Slovenia","Spain","Sweden","Switzerland","Ukraine","United Kingdom","Vatican City"],
  northamerica: ["Canada","United States","Mexico","Belize","Costa Rica","El Salvador","Guatemala","Honduras","Nicaragua","Panama","Bahamas","Barbados","Cuba","Dominica","Dominican Republic","Grenada","Haiti","Jamaica","Saint Kitts and Nevis","Saint Lucia","Saint Vincent and the Grenadines","Trinidad and Tobago"],
  southamerica: ["Argentina","Bolivia","Brazil","Chile","Colombia","Ecuador","Guyana","Paraguay","Peru","Suriname","Uruguay","Venezuela"],
  oceania: ["Australia","Fiji","Kiribati","Marshall Islands","Micronesia","Nauru","New Zealand","Palau","Papua New Guinea","Samoa","Solomon Islands","Tonga","Tuvalu","Vanuatu"],
  middleeast: ["Bahrain","Cyprus","Iran","Iraq","Israel","Jordan","Kuwait","Lebanon","Oman","Palestine","Qatar","Saudi Arabia","Syria","United Arab Emirates","Yemen","Turkey"]
};

const indiaCapitals = {
"Andhra Pradesh":["Amaravati"],"Arunachal Pradesh":["Itanagar"],"Assam":["Dispur"],
"Bihar":["Patna"],"Chhattisgarh":["Raipur"],"Goa":["Panaji"],"Gujarat":["Gandhinagar"],
"Haryana":["Chandigarh"],"Himachal Pradesh":["Shimla"],"Jharkhand":["Ranchi"],
"Karnataka":["Bengaluru"],"Kerala":["Thiruvananthapuram"],"Madhya Pradesh":["Bhopal"],
"Maharashtra":["Mumbai"],"Manipur":["Imphal"],"Meghalaya":["Shillong"],"Mizoram":["Aizawl"],
"Nagaland":["Kohima"],"Odisha":["Bhubaneswar"],"Punjab":["Chandigarh"],"Rajasthan":["Jaipur"],
"Sikkim":["Gangtok"],"Tamil Nadu":["Chennai"],"Telangana":["Hyderabad"],
"Tripura":["Agartala"],"Uttar Pradesh":["Lucknow"],"Uttarakhand":["Dehradun"],
"West Bengal":["Kolkata"]
};

const canadaCapitals = {
"Alberta":["Edmonton"],"British Columbia":["Victoria"],"Manitoba":["Winnipeg"],
"New Brunswick":["Fredericton"],"Newfoundland and Labrador":["St. John's"],
"Nova Scotia":["Halifax"],"Ontario":["Toronto"],"Prince Edward Island":["Charlottetown"],
"Quebec":["Quebec City"],"Saskatchewan":["Regina"],"Northwest Territories":["Yellowknife"],
"Nunavut":["Iqaluit"],"Yukon":["Whitehorse"]
};

// -------- STRING HELPERS --------
function normalize(str) {
  return str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z\s]/g,"").replace(/\s+/g," ").trim();
}

function levenshtein(a,b){
  const matrix=Array.from({length:b.length+1},(_,i)=>[i]);
  for(let j=0;j<=a.length;j++) matrix[0][j]=j;
  for(let i=1;i<=b.length;i++){
    for(let j=1;j<=a.length;j++){
      matrix[i][j]=b[i-1]===a[j-1]?matrix[i-1][j-1]:Math.min(matrix[i-1][j-1]+1,matrix[i][j-1]+1,matrix[i-1][j]+1);
    }
  }
  return matrix[b.length][a.length];
}

function similarity(a,b){
  return 1-levenshtein(a,b)/Math.max(a.length,b.length);
}

// -------- GAME FUNCTIONS --------
function getCurrentCategoryData(){
  const cat=document.getElementById("category").value;
  if(cat==="india") return indiaCapitals;
  if(cat==="canada") return canadaCapitals;
  if(continents[cat]){
    const keys=continents[cat];
    let subset={};
    keys.forEach(k=>{if(worldCapitals[k])subset[k]=worldCapitals[k];});
    return subset;
  }
  return worldCapitals;
}

function nextQuestion(){
  if(total>=30){
    document.getElementById("question").innerText="üéâ Session Complete!";
    document.getElementById("answerArea").innerHTML="";
    document.getElementById("result").innerHTML=`Your final score: ${score} / 30 üéâ`;
    return;
  }
  document.getElementById("result").innerHTML="";
  document.getElementById("answerArea").innerHTML="";
  const data=getCurrentCategoryData();
  const keys=Object.keys(data);
  const country=keys[Math.floor(Math.random()*keys.length)];
  currentAnswer=data[country];
  document.getElementById("question").innerText="Capital of "+country+"?";
  renderInput();
}

function renderInput(){
  const area=document.getElementById("answerArea");
  const mc=document.getElementById("mcMode").checked;
  area.innerHTML="";
  if(mc){
    let choices=[currentAnswer[0]];
    const allValues=Object.values(getCurrentCategoryData()).flat();
    while(choices.length<4){const rand=allValues[Math.floor(Math.random()*allValues.length)];if(!choices.includes(rand))choices.push(rand);}
    choices.sort(()=>Math.random()-0.5);
    choices.forEach(c=>{const btn=document.createElement("button");btn.innerText=c;btn.onclick=()=>submitAnswer(c);area.appendChild(btn);});
  } else {
    area.innerHTML=`<input type="text" id="textAnswer" placeholder="Type answer">`;
  }
}

function submitAnswer(selected){
  if(total>=30){return;}
  let userAnswer=selected;
  const inputField=document.getElementById("textAnswer");
  if(!userAnswer&&inputField) userAnswer=inputField.value.trim();
  if(!userAnswer) return;
  total++;
  const difficulty=document.getElementById("difficulty").value;
  const user=normalize(userAnswer);
  let accepted=false;
  for(let ans of currentAnswer){
    const correct=normalize(ans);
    if(user===correct){accepted="exact";break;}
    else if(difficulty!=="hard"&&similarity(user,correct)>=(difficulty==="easy"?0.75:0.85)){accepted="tolerant";break;}
  }
  if(accepted){
    score++;
    soundCorrect.play();
    document.getElementById("result").innerHTML=accepted==="exact"?`<div class="correct">‚úÖ Correct!</div>`:`<div class="accepted">üü° Accepted (minor spelling error)</div>`;
  } else {
    soundWrong.play();
    document.getElementById("result").innerHTML=`<div class="wrong">‚ùå Wrong. Correct: ${currentAnswer.join(", ")}</div>`;
  }
  document.getElementById("score").innerText=`Score: ${score} / ${total}`;
}

function revealAnswer(){
  document.getElementById("result").innerHTML=`<div class="accepted">üí° Answer: ${currentAnswer.join(", ")}</div>`;
}

function resetScore(){
  score=0;
  total=0;
  document.getElementById("score").innerText="Score: 0 / 0";
  document.getElementById("result").innerHTML="";
  nextQuestion();
}

// -------- NEW: Start Quiz --------
function startQuiz(){
  score=0;
  total=0;
  document.getElementById("score").innerText="Score: 0 / 0";
  document.getElementById("result").innerHTML="";
  nextQuestion();
}
</script>

</body>
</html>
